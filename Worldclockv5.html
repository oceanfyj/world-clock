<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Clock Pro 3.2 | Persistence & Graphics</title>
    <style>
        :root {
            /* Defaults */
            --bg: #f0f2f5; 
            --card: #ffffff; 
            --text: #1a1a1a; 
            --accent: #0052cc; 
            --border: #dcdde1; 
            --hand: #333333; 
            --num-color: #57606f;
            
            /* New Graphic Vars */
            --face-bg: #f8f9fa; /* Default flat face */
            --face-border: 3px solid #0052cc;
            --face-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            --center-dot: #333;
        }

        /* --- THEME DEFINITIONS (Graphical Upgrades) --- */
        
        /* 1. Dark (Matte Finish) */
        body.t-dark { 
            --bg: #121212; --card: #1e1e1e; --text: #ffffff; --accent: #4dabf7; --border: #333; --hand: #fff; --num-color: #a4b0be; 
            --face-bg: radial-gradient(circle at center, #2d3436 0%, #000000 100%);
            --face-border: 3px solid #4dabf7;
            --face-shadow: inset 0 0 10px rgba(0,0,0,0.8);
            --center-dot: #fff;
        }
        
        /* 2. Neon (Cyber Glow) */
        body.t-neon { 
            --bg: #050505; --card: #111; --text: #39ff14; --accent: #39ff14; --border: #1a1a1a; --hand: #39ff14; --num-color: #39ff14; 
            --face-bg: radial-gradient(circle, #000 60%, #112211 100%);
            --face-border: 3px solid #39ff14;
            --face-shadow: 0 0 15px #39ff14, inset 0 0 20px rgba(57, 255, 20, 0.2);
            --center-dot: #39ff14;
        }

        /* 3. Luxury (Gold Brushed Metal) */
        body.t-luxury { 
            --bg: #1c1c1c; --card: #2a2a2a; --text: #d4af37; --accent: #d4af37; --border: #444; --hand: #f5f5f5; --num-color: #d4af37; 
            --face-bg: linear-gradient(135deg, #444 0%, #222 50%, #444 100%);
            --face-border: 4px solid #d4af37;
            --face-shadow: inset 0 0 10px #000;
            --center-dot: #d4af37;
        }

        /* 4. Retro (Old Paper/Vintage) */
        body.t-retro { 
            --bg: #fdf6e3; --card: #eee8d5; --text: #586e75; --accent: #b58900; --border: #d2b48c; --hand: #2c3e50; --num-color: #586e75; 
            --face-bg: radial-gradient(#fffdf5, #f0e6ce);
            --face-border: 3px double #b58900;
            --face-shadow: inset 0 0 15px rgba(181, 137, 0, 0.1);
            --center-dot: #b58900;
        }

        /* 5. Ocean (Water Gradient) */
        body.t-ocean { 
            --bg: #e3f2fd; --card: #fff; --text: #01579b; --accent: #0288d1; --border: #81d4fa; --hand: #01579b; --num-color: #0277bd; 
            --face-bg: radial-gradient(circle at 50% 30%, #b3e5fc, #4fc3f7);
            --face-border: 3px solid #0288d1;
            --face-shadow: inset 0 0 5px rgba(2, 136, 209, 0.3);
            --center-dot: #01579b;
        }

        /* 6. Cyber (Tech Grid) */
        body.t-cyber { 
            --bg: #1a0b2e; --card: #2d1452; --text: #f0f; --accent: #0ff; --border: #502c7a; --hand: #0ff; --num-color: #0ff; 
            --face-bg: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(#2d1452, #000);
            --face-bg-size: 20px 20px, 20px 20px, 100% 100%; /* Only works if applied directly, doing simplified version in var */
            --face-border: 3px solid #f0f;
            --face-shadow: 0 0 10px #f0f;
            --center-dot: #0ff;
        }
        /* Special override for cyber background size logic */
        body.t-cyber .clock { background-size: 20px 20px, 20px 20px, 100% 100%; }

        /* 7. Minimal (Clean Bauhaus) */
        body.t-minimal { 
            --bg: #fff; --card: #fff; --text: #000; --accent: #000; --border: #000; --hand: #000; --num-color: #000; 
            --face-bg: #fff;
            --face-border: 4px solid #000;
            --face-shadow: none;
            --center-dot: #000;
        }

        /* 8. Forest (Natural Texture) */
        body.t-forest { 
            --bg: #f1f8e9; --card: #fff; --text: #1b5e20; --accent: #388e3c; --border: #a5d6a7; --hand: #1b5e20; --num-color: #2e7d32; 
            --face-bg: conic-gradient(from 180deg at 50% 50%, #dcedc8 0deg, #c5e1a5 360deg);
            --face-border: 3px solid #33691e;
            --face-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            --center-dot: #558b2f;
        }

        /* 9. Sunset (Warm Gradient) */
        body.t-sunset { 
            --bg: #fff3e0; --card: #fff; --text: #bf360c; --accent: #e64a19; --border: #ffab91; --hand: #bf360c; --num-color: #d84315; 
            --face-bg: linear-gradient(to top, #ffccbc 0%, #ffe0b2 100%);
            --face-border: 3px solid #e64a19;
            --face-shadow: 0 5px 15px rgba(230, 74, 25, 0.15);
            --center-dot: #bf360c;
        }

        /* 10. Slate (Professional Blue-Grey) */
        body.t-slate { 
            --bg: #2f3640; --card: #353b48; --text: #f5f6fa; --accent: #487eb0; --border: #718093; --hand: #f5f6fa; --num-color: #dcdde1; 
            --face-bg: radial-gradient(circle, #353b48 60%, #2f3640 100%);
            --face-border: 3px solid #718093;
            --face-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            --center-dot: #487eb0;
        }

        body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; transition: background-color 0.3s ease, color 0.3s ease; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 280px; background: rgba(0,0,0,0.05); height: 100vh; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; border-right: 1px solid var(--border); transition: border 0.3s; }
        .sidebar-section { margin-bottom: 25px; }
        .sidebar h3 { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; margin-bottom: 12px; }

        #search-box { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); box-sizing: border-box; background: var(--card); color: var(--text); transition: all 0.3s; }
        .search-results { max-height: 300px; overflow-y: auto; background: var(--card); border: 1px solid var(--border); border-radius: 6px; margin-top: 5px; display: none; }
        .search-item { padding: 10px; cursor: pointer; border-bottom: 1px solid var(--border); font-size: 14px; }
        .search-item:hover { background: var(--accent); color: white; }

        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .t-btn { padding: 8px; border: 1px solid var(--border); border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; background: var(--card); color: var(--text); }
        .t-btn:hover { border-color: var(--accent); opacity: 0.8; }
        
        .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .clock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        
        .card { background: var(--card); border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--border); position: relative; transition: background 0.3s, border 0.3s; }
        .rm-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ff4757; cursor: pointer; font-size: 20px; font-weight: bold; }

        /* CLOCK FACE UPGRADE */
        .clock { 
            width: 150px; 
            height: 150px; 
            border-radius: 50%; 
            margin: 0 auto 15px; 
            position: relative; 
            
            /* Apply new graphical vars */
            background: var(--face-bg);
            border: var(--face-border);
            box-shadow: var(--face-shadow);
            transition: all 0.3s ease;
        }

        /* Center dot for realism */
        .clock::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 10px; height: 10px;
            background: var(--center-dot);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
        }

        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: var(--hand); border-radius: 4px; transform: translateX(-50%); transition: background 0.3s; }
        .h-h { width: 5px; height: 40px; z-index: 3; }
        .m-h { width: 3px; height: 55px; z-index: 2; }
        .s-h { width: 1.5px; height: 60px; background: #ff4757; z-index: 1; }
        
        .clk-num { 
            position: absolute; 
            font-size: 18px; 
            font-weight: bold; 
            color: var(--num-color);
            width: 20px; 
            height: 20px; 
            line-height: 20px; 
            text-align: center;
            transition: color 0.3s;
        }
        .n-12 { top: 8px; left: 50%; transform: translateX(-50%); }
        .n-6  { bottom: 8px; left: 50%; transform: translateX(-50%); }
        .n-3  { right: 8px; top: 50%; transform: translateY(-50%); }
        .n-9  { left: 8px; top: 50%; transform: translateY(-50%); }

        .digital { font-size: 1.6rem; font-weight: bold; font-family: 'Courier New', monospace; margin: 10px 0 5px; }
        .date { font-size: 0.9rem; opacity: 0.7; font-weight: 500; }
        .city { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; }
    </style>
</head>
<body id="b">

    <div class="sidebar">
        <div class="sidebar-section">
            <h3>üåç Global Search</h3>
            <input type="text" id="search-box" placeholder="Search (e.g. Jordan, UK)..." onkeyup="search()">
            <div id="results" class="search-results"></div>
        </div>

        <div class="sidebar-section">
            <h3>üé® Clock Face Style</h3>
            <div class="theme-grid">
                <button class="t-btn" onclick="st('')">Classic</button>
                <button class="t-btn" onclick="st('t-dark')">Dark</button>
                <button class="t-btn" onclick="st('t-neon')">Neon</button>
                <button class="t-btn" onclick="st('t-luxury')">Luxury</button>
                <button class="t-btn" onclick="st('t-retro')">Retro</button>
                <button class="t-btn" onclick="st('t-ocean')">Ocean</button>
                <button class="t-btn" onclick="st('t-cyber')">Cyber</button>
                <button class="t-btn" onclick="st('t-minimal')">Minimal</button>
                <button class="t-btn" onclick="st('t-forest')">Forest</button>
                <button class="t-btn" onclick="st('t-slate')">Slate</button>
            </div>
        </div>
        <p style="font-size: 10px; opacity: 0.5; margin-top: auto;">World Clock Pro v3.2<br>Auto-Save Enabled</p>
    </div>

    <div class="main-content">
        <div class="clock-grid" id="grid">
            <div class="card" id="local-card">
                <div class="city">üìç Local Time</div>
                <div class="clock">
                    <div class="clk-num n-12">12</div>
                    <div class="clk-num n-3">3</div>
                    <div class="clk-num n-6">6</div>
                    <div class="clk-num n-9">9</div>
                    <div class="hand h-h" id="lh"></div>
                    <div class="hand m-h" id="lm"></div>
                    <div class="hand s-h" id="ls"></div>
                </div>
                <div class="digital" id="ld">--:--:-- --</div>
                <div class="date" id="ldt">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        const countryDB = [
            {n: "Afghanistan", z: "Asia/Kabul"}, 
            {n: "Australia (Sydney)", z: "Australia/Sydney"}, 
            {n: "Australia (Adelaide)", z: "Australia/Adelaide"}, 
            {n: "Australia (Perth)", z: "Australia/Perth"}, 
            {n: "Austria", z: "Europe/Vienna"}, 
            {n: "Bangladesh", z: "Asia/Dhaka"}, 
            {n: "Belgium", z: "Europe/Brussels"}, 
            {n: "Brazil", z: "America/Sao_Paulo"}, 
            {n: "Canada (Toronto)", z: "America/Toronto"}, 
            {n: "Canada (Vancouver)", z: "America/Vancouver"}, 
            {n: "China", z: "Asia/Shanghai"}, 
            {n: "Denmark", z: "Europe/Copenhagen"}, 
            {n: "Egypt", z: "Africa/Cairo"}, 
            {n: "France", z: "Europe/Paris"}, 
            {n: "Germany", z: "Europe/Berlin"}, 
            {n: "Greece", z: "Europe/Athens"}, 
            {n: "Hong Kong", z: "Asia/Hong_Kong"}, 
            {n: "India", z: "Asia/Kolkata"}, 
            {n: "Indonesia", z: "Asia/Jakarta"}, 
            {n: "Iran", z: "Asia/Tehran"}, 
            {n: "Israel", z: "Asia/Jerusalem"}, 
            {n: "Italy", z: "Europe/Rome"}, 
            {n: "Japan", z: "Asia/Tokyo"},
            {n: "Jordan", z: "Asia/Amman"},
            {n: "Korea (South)", z: "Asia/Seoul"}, 
            {n: "Malaysia", z: "Asia/Kuala_Lumpur"}, 
            {n: "Mexico", z: "America/Mexico_City"}, 
            {n: "Nepal", z: "Asia/Kathmandu"}, 
            {n: "Netherlands", z: "Europe/Amsterdam"}, 
            {n: "New Zealand", z: "Pacific/Auckland"}, 
            {n: "Nigeria", z: "Africa/Lagos"}, 
            {n: "Norway", z: "Europe/Oslo"}, 
            {n: "Pakistan", z: "Asia/Karachi"}, 
            {n: "Philippines", z: "Asia/Manila"}, 
            {n: "Portugal", z: "Europe/Lisbon"}, 
            {n: "Russia (Moscow)", z: "Europe/Moscow"}, 
            {n: "Singapore", z: "Asia/Singapore"}, 
            {n: "South Africa", z: "Africa/Johannesburg"}, 
            {n: "Spain", z: "Europe/Madrid"}, 
            {n: "Switzerland", z: "Europe/Zurich"}, 
            {n: "Taiwan", z: "Asia/Taipei"}, 
            {n: "Thailand", z: "Asia/Bangkok"}, 
            {n: "Turkey", z: "Europe/Istanbul"}, 
            {n: "UAE (Dubai)", z: "Asia/Dubai"}, 
            {n: "UK (London)", z: "Europe/London"}, 
            {n: "USA (New York)", z: "America/New_York"}, 
            {n: "USA (Chicago)", z: "America/Chicago"}, 
            {n: "USA (Los Angeles)", z: "America/Los_Angeles"}, 
            {n: "Vietnam", z: "Asia/Ho_Chi_Minh"}
        ];

        let clocks = [];

        // Save Function
        function saveSettings() {
            const data = {
                theme: document.getElementById('b').className,
                list: clocks.map(c => ({n: c.name, z: c.zone}))
            };
            localStorage.setItem('wcpro_data', JSON.stringify(data));
        }

        // Updated Theme Switcher
        const st = (t) => {
            document.getElementById('b').className = t;
            saveSettings();
        }

        function search() {
            const q = document.getElementById('search-box').value.toLowerCase();
            const resDiv = document.getElementById('results');
            if(!q) { resDiv.style.display = 'none'; return; }
            const filtered = countryDB.filter(c => c.n.toLowerCase().includes(q));
            resDiv.innerHTML = filtered.map(c => `<div class="search-item" onclick="add('${c.n}', '${c.z}')">${c.n}</div>`).join('');
            resDiv.style.display = filtered.length ? 'block' : 'none';
        }

        // Updated Add function with Save
        function add(name, zone, skipSave = false) {
            // Check duplicates
            if(clocks.some(c => c.name === name)) {
                if(!skipSave) alert("Clock already exists!"); 
                document.getElementById('search-box').value = '';
                document.getElementById('results').style.display = 'none';
                return;
            }
            if(clocks.length >= 23) return alert("Maximum 24 clocks reached.");
            
            const id = 'c' + Date.now() + Math.random().toString(16).slice(2);
            
            const div = document.createElement('div');
            div.className = 'card';
            div.id = `card-${id}`;
            div.innerHTML = `<button class="rm-btn" onclick="rm('${id}')">√ó</button>
                <div class="city">${name}</div>
                <div class="clock">
                    <div class="clk-num n-12">12</div>
                    <div class="clk-num n-3">3</div>
                    <div class="clk-num n-6">6</div>
                    <div class="clk-num n-9">9</div>
                    <div class="hand h-h" id="h-${id}"></div><div class="hand m-h" id="m-${id}"></div><div class="hand s-h" id="s-${id}"></div>
                </div>
                <div class="digital" id="d-${id}">Loading...</div>
                <div class="date" id="dt-${id}">--</div>`;
            
            document.getElementById('grid').appendChild(div);
            
            clocks.push({
                id, zone, name,
                dom: {
                    h: document.getElementById(`h-${id}`),
                    m: document.getElementById(`m-${id}`),
                    s: document.getElementById(`s-${id}`),
                    d: document.getElementById(`d-${id}`),
                    dt: document.getElementById(`dt-${id}`)
                }
            });
            
            document.getElementById('search-box').value = '';
            document.getElementById('results').style.display = 'none';
            tick(); 
            
            if(!skipSave) saveSettings();
        }

        // Updated Remove function with Save
        function rm(id) {
            clocks = clocks.filter(c => c.id !== id);
            const card = document.getElementById(`card-${id}`);
            if(card) card.remove();
            saveSettings();
        }

        function tick() {
            const now = new Date();
            
            // Update Local Time
            rotate('l', now);
            document.getElementById('ld').innerText = now.toLocaleTimeString('en-US', {hour12: true});
            document.getElementById('ldt').innerText = now.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
            
            // Update World Clocks
            clocks.forEach(c => {
                const t = new Date(now.toLocaleString('en-US', {timeZone: c.zone}));
                
                c.dom.d.innerText = t.toLocaleTimeString('en-US', {hour12: true});
                c.dom.dt.innerText = t.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});

                const h = t.getHours();
                const m = t.getMinutes();
                const s = t.getSeconds();

                const hDeg = (h % 12) * 30 + m * 0.5;
                const mDeg = m * 6;
                const sDeg = s * 6;

                c.dom.h.style.transform = `translateX(-50%) rotate(${hDeg}deg)`;
                c.dom.m.style.transform = `translateX(-50%) rotate(${mDeg}deg)`;
                c.dom.s.style.transform = `translateX(-50%) rotate(${sDeg}deg)`;
            });
        }

        function rotate(id, date) {
            const h = date.getHours(), m = date.getMinutes(), s = date.getSeconds();
            const el = (suf) => document.getElementById(id + suf);
            if(el('h')) el('h').style.transform = `translateX(-50%) rotate(${(h%12)*30 + m*0.5}deg)`;
            if(el('m')) el('m').style.transform = `translateX(-50%) rotate(${m*6}deg)`;
            if(el('s')) el('s').style.transform = `translateX(-50%) rotate(${s*6}deg)`;
        }

        // Load Settings on Start
        function loadSettings() {
            const saved = localStorage.getItem('wcpro_data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    // Load Theme
                    if(data.theme) document.getElementById('b').className = data.theme;
                    // Load Clocks
                    if(data.list && Array.isArray(data.list)) {
                        data.list.forEach(c => add(c.n, c.z, true)); // true = skip duplicate save
                    }
                } catch(e) {
                    console.error("Error loading settings", e);
                }
            }
        }

        // Init
        loadSettings();
        setInterval(tick, 1000);
        tick();
    </script>
</body>
</html>